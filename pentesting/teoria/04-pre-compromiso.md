# 04 - Pre-Compromiso: Arquitectura Legal y Operativa üèóÔ∏è

> **üéØ Objetivo:** Dominar la fase de preparaci√≥n de una prueba de penetraci√≥n. Aprender√°s a gestionar la burocracia, protegerte legalmente contra demandas y definir con precisi√≥n quir√∫rgica qu√© atacar√°s y c√≥mo, antes de tocar una sola tecla.
---
### 1. El Panorama General: ¬øQu√© es el Pre-Compromiso?

El Pre-Compromiso es todo lo que ocurre antes de la acci√≥n. Es la etapa donde se hacen preguntas, se firman contratos y se establecen l√≠mites.

Imagina que vas a construir un rascacielos. No empiezas poniendo ladrillos al azar; primero necesitas planos, permisos del ayuntamiento y contratos con los due√±os. En Ciberseguridad es igual:

- El cliente nos dice qu√© quiere (Alcance).
    
- Nosotros explicamos c√≥mo lo haremos (Metodolog√≠a).
    
- Ambos firmamos para protegernos (Legal).
    

Este proceso tiene tres hitos principales:

1. **Cuestionario de Alcance (Scoping):** La toma de requerimientos.
    
2. **Reuni√≥n Previa al Compromiso:** La negociaci√≥n y planificaci√≥n.
    
3. **Reuni√≥n de Inicio (Kick-off):** El √∫ltimo paso antes del ataque.
    

---

### 2. La Autoridad: ¬øQui√©n tiene la pluma? ‚úçÔ∏è

‚ö†Ô∏è Peligro Cr√≠tico: No puedes aceptar un trabajo de cualquiera.

Imagina que un empleado de TI te contrata para "auditar" la red, pero en realidad quiere sabotear la empresa antes de renunciar. Si lo haces, eres c√≥mplice.

Debes asegurarte de que quien firma tiene **autoridad real**. Generalmente buscamos el **Nivel C (C-Level)** o Alta Direcci√≥n:

- **CEO:** Director Ejecutivo.
    
- **CTO:** Director T√©cnico.
    
- **CISO:** Director de Seguridad de la Informaci√≥n.
    
- **CSO:** Director de Seguridad.
    
- **CRO:** Director de Riesgos.
    
- **CIO:** Director de Informaci√≥n.
    
- **VP de Auditor√≠a Interna.**
  
![[jerarquia-corporativa.png]]

> **üí° Nota:** En empresas enormes, el CEO no firmar√°. La responsabilidad delegada recae en la alta direcci√≥n de TI o Seguridad. Debes verificar qui√©n es el **Punto de Contacto (POC)** principal.

---

### 3. El Primer Paso: Acuerdos de Confidencialidad (NDA) ü§ê

Antes de discutir secretos, necesitamos silencio legal. Un NDA (_Non-Disclosure Agreement_) se firma tras el primer contacto.

|**Tipo de NDA**|**Descripci√≥n**|**¬øCu√°ndo se usa?**|
|---|---|---|
|**Unilateral**|Solo una parte guarda el secreto.|El cliente te cuenta su idea; t√∫ callas, ellos no tienen restricciones.|
|**Bilateral**|**Ambas partes** guardan el secreto.|**El Est√°ndar en Pentesting.** Protege los datos del cliente y tus metodolog√≠as.|
|**Multilateral**|M√°s de dos partes involucradas.|Redes cooperativas o proyectos con m√∫ltiples proveedores.|
> **üí° Nota:** Nunca inicies una conversaci√≥n detallada sobre vulnerabilidades o redes sin un NDA firmado. Es tu primera l√≠nea de defensa.

---

### 4. Cronolog√≠a Documental (El Flujo de Trabajo) ‚è≥

Este es el orden estricto en que se generan los documentos. No alteres este orden.

| **Documento**                               | **Momento de Creaci√≥n**                       | **Funci√≥n Principal**                                         |
| ------------------------------------------- | --------------------------------------------- | ------------------------------------------------------------- |
| **1. NDA (Acuerdo de Confidencialidad)**    | **Despu√©s** del contacto inicial.             | Permite hablar sin miedo.                                     |
| **2. Cuestionario de Alcance (Scoping Q.)** | **Antes** de la reuni√≥n previa.               | El cliente define qu√© quiere probar.                          |
| **3. Documento de Alcance (Scoping Doc.)**  | **Durante** la reuni√≥n previa.                | Nosotros resumimos lo que entendimos del cliente.             |
| **4. Propuesta / Contrato (SoW)**           | **Durante** la reuni√≥n previa.                | Define precio, plazos y condiciones legales.                  |
| **5. Reglas de Enfrentamiento (RoE)**       | **Antes** de la reuni√≥n de inicio (Kick-off). | Define C√ìMO se atacar√° t√©cnicamente (IPs, m√©todos).           |
| **6. Acuerdo de Contratista**               | **Antes** de la reuni√≥n de inicio.            | **Solo para pruebas f√≠sicas**. Es el permiso legal de acceso. |
| **7. Informes (Reports)**                   | **Durante** y **Despu√©s** del test.           | La entrega de resultados.                                     |

---

### 5. Definiendo el Men√∫: El Cuestionario de Alcance (Scoping) üìã

Aqu√≠ enviamos al cliente un formulario para entender qu√© "plato" quiere del men√∫.

**A. Selecci√≥n de Servicios (Checklist T√≠pica):**

- [ ] Evaluaci√≥n de Vulnerabilidades (Interna/Externa).
    
- [ ] Pentest (Interno/Externo).
    
- [ ] Seguridad Inal√°mbrica (Wifi).
    
- [ ] Aplicaciones (Web/M√≥vil).
    
- [ ] Ingenier√≠a Social (Phishing/Vishing) o F√≠sico.
    
- [ ] Red Teaming (Simulacro completo de adversario).
    

**B. Preguntas de Calibraci√≥n (Los detalles que definen el precio):**

- **Volumen:** ¬øCu√°ntas IPs? ¬øRangos CIDR? ¬øDominios/Subdominios? ¬øSSID inal√°mbricos?
    
- **Aplicaciones:** ¬øCu√°ntos roles de usuario (admin, user)? ¬øEs Whitebox (nos dan c√≥digo/credenciales) o Blackbox (a ciegas)?
    
- **Personas:** Para Phishing, ¬øcu√°ntos objetivos? ¬øNos dan la lista o debemos investigarla (OSINT)?
    
- **Ubicaci√≥n:** ¬øCu√°ntas oficinas f√≠sicas? ¬øEst√°n dispersas geogr√°ficamente?
    
- **Modo:** ¬øEvasivo (sigiloso) o No-Evasivo (ruidoso)? ¬øSaltamos el NAC?
    

> **üí° Nota:** Esta informaci√≥n es vital para calcular el **tiempo** y el **costo**. Un test a 10 IPs es barato; un test a una red `/24` (254 IPs) interna es costoso.

---

### 6. Reuni√≥n Previa al Compromiso y el Contrato (SoW) ü§ù

Con el cuestionario en mano, nos reunimos (online o presencial) para afinar detalles. Aqu√≠ se crea la **Propuesta de Pentesting** o **Scope of Work (SoW)**.

Piensa en esta reuni√≥n como pedir en un restaurante: _"Si quieres el filete t√©rmino medio, no te lo daremos bien cocido"_. Ajustamos nuestras capacidades a sus deseos.

#### üìù Checklist Detallada del Contrato (SoW)

Este documento es comercial y legal. Define el "QU√â".

|**Punto de Control**|**Detalle Obligatorio**|
|---|---|
|**Metas (Goals)**|Hitos grandes y peque√±os a lograr.|
|**Alcance (Scope)**|Definici√≥n de alto nivel de dominios, IPs y sistemas a probar.|
|**Tipo de Test**|Caja Negra/Gris/Blanca. Explicamos ventajas y desventajas, pero el cliente decide.|
|**Metodolog√≠as**|Est√°ndares a usar: OSSTMM, OWASP, PTES, NIST.|
|**Ubicaciones**|¬øDesde d√≥nde atacamos? (VPN Remota o In-Situ).|
|**Estimaci√≥n de Tiempo**|Fechas de inicio y fin. Ventanas para explotaci√≥n y post-explotaci√≥n.|
|**Terceros (Third Parties)**|**CR√çTICO:** Si el cliente usa AWS, Azure o un ISP espec√≠fico, necesitamos permiso escrito de esos proveedores.|
|**Pruebas Evasivas**|¬øDebemos intentar burlar al Blue Team y sus defensas?|
|**Riesgos**|Advertencia sobre posibles ca√≠das de servicio o bloqueos de usuarios.|
|**Limitaciones**|Qu√© servidores son "sagrados" y no deben tocarse para no detener el negocio del cliente.|
|**Manejo de Info**|Cumplimiento con HIPAA, PCI, GDPR, etc.|
|**Contactos**|Lista con: Nombre, Cargo, Email, Tel√©fono y **Orden de escalada**.|
|**Reportes**|Estructura del informe final y si habr√° presentaci√≥n ejecutiva.|
|**Pagos**|Precios y condiciones de facturaci√≥n.|

---

### 7. Reglas de Enfrentamiento (RoE): La Biblia T√©cnica ‚öîÔ∏è

Este documento se genera bas√°ndose en el contrato, pero es **puramente t√©cnico**. Es el manual operativo para los pentesters. Se finaliza antes de la Reuni√≥n de Inicio.

#### üõ†Ô∏è Checklist Detallada del RoE

Este documento define el "C√ìMO".

|**Secci√≥n**|**Elemento**|**Descripci√≥n Cr√≠tica**|
|---|---|---|
|**Identidad**|Pentesters|Nombres reales de qui√©nes realizar√°n el ataque (para que no los arresten).|
||Contactos|Tel√©fonos 24/7 de ambos lados.|
|**T√©cnico**|**Alcance Exacto**|Lista espec√≠fica de IPs, URLs y Rangos. **Nada de ambig√ºedades.**|
||**Exclusiones**|Qu√© NO tocar bajo ninguna circunstancia.|
||Ventana Horaria|¬øA qu√© hora exacta del d√≠a se prueba? (Ej: 08:00 - 17:00).|
||Ubicaciones|C√≥mo nos conectamos (VPN, f√≠sicamente en la sala de servidores).|
||Objetivos / Flags|Informaci√≥n espec√≠fica a capturar (ej: `database.sql`, `admin password`).|
|**Datos**|Manejo de Evidencia|Uso de cifrado fuerte para guardar datos robados.|
||Backups|Confirmaci√≥n de que existen copias de seguridad del cliente.|
|**Emergencia**|**Incident Handling**|¬øQu√© hacemos si tiramos un servidor? ¬øA qui√©n llamamos?|
||Reuniones de Estado|Frecuencia de reportes de avance (diario/semanal).|
|**Legal**|Descargos|Limitaci√≥n de responsabilidad por da√±os accidentales.|
||Permiso|Referencia al contrato firmado que autoriza el hacking.|

---

### 8. Reuni√≥n de Inicio (Kick-off Meeting) üöÄ

Se hace en persona o videollamada **despu√©s** de firmar todo.

- **Asistentes:** Pentesters + Equipo T√©cnico del Cliente (SysAdmins, Redes, Seguridad).
    
- **Objetivo:** "Humanizar" el ataque y explicar el proceso.
    
- **Puntos Clave:**
    
    1. **NO DoS:** Aclarar que no haremos Denegaci√≥n de Servicio intencional.
        
    2. **Protocolo de Hallazgo Cr√≠tico:** Si encontramos algo muy grave (ej: RCE, datos sensibles expuestos), **PAUSAMOS** y avisamos inmediatamente. No esperamos al reporte final.
        
    3. **Ruido:** Avisar que generaremos logs y alertas en sus sistemas.
        

---

### 9. El Acuerdo de Contratista (Solo F√≠sico) üèÉ

Si la prueba implica entrar a oficinas (Ingenier√≠a Social presencial o acceso f√≠sico), las leyes de propiedad privada aplican.

**Checklist para Evaluaciones F√≠sicas:**

- [ ] **Introducci√≥n y Prop√≥sito:** ¬øPor qu√© est√°s ah√≠?
    
- [ ] **Identificaci√≥n:** Tus datos completos.
    
- [ ] **Ubicaciones:** Direcciones exactas, nombres de edificios.
    
- [ ] **Zonas:** Pisos permitidos, identificaci√≥n de salas (Server Room vs Recepci√≥n).
    
- [ ] **Cronograma:** Fecha y hora exacta.
    
- [ ] **Notarizaci√≥n:** Firma legal ante notario (a veces requerida).
    
- [ ] **Permiso Explicito:** Autorizaci√≥n firmada para estar en la propiedad.
    
> **üõ°Ô∏è Nota de Seguridad:** Este documento es tu "Get Out of Jail Free Card". Si un guardia de seguridad o un empleado diligente te atrapa y llama a la polic√≠a, este documento demuestra que est√°s autorizado para estar all√≠ y realizar esa actividad. Sin √©l, te vas arrestado.

 ![[get-out-jail-free-card.png]]

---

### 10. Montaje (Setup) üíª

Una vez firmado todo, preparas tu infraestructura t√©cnica:

- Configuraci√≥n de M√°quinas Virtuales (VMs).
    
- Servidores VPS para Command & Control (C2).
    
- Herramientas listas seg√∫n el escenario pactado.

---
### 11. Caso Pr√°ctico: ¬øC√≥mo se ve esto en la vida real? üõ†Ô∏è
Imaginemos que eres un hacker √©tico (pentester) que ofrece sus servicios y la empresa "BancoSeguro" te contacta para una prueba.
##### Paso 1: **El Contacto y NDA** 
  * El CISO de BancoSeguro te escribe. 
  * T√∫ respondes: "Encantado. Antes de que me cuentes detalles de tu red, por favor firmemos este NDA Bilateral".
##### Paso 2: **El Cuestionario (Scoping):** 
* Les env√≠as el formulario y ellos responden:
	* Objetivo: Su nueva App M√≥vil de transferencias.
	- _Tipo:_ Caja Gris (te dar√°n un usuario de prueba).
	- _Entorno:_ Producci√≥n (¬°Cuidado! Hay usuarios reales).
##### Paso 3: **Creaci√≥n de la Propuesta (SoW)**
* Analizas: "Probar una App m√≥vil en producci√≥n es delicado".
	* Tu propuesta dice: "Probaremos la App (iOS y Android) durante 5 d√≠as. 
	* Costo: $X.
	* No realizaremos ataques de Denegaci√≥n de Servicio para no afectar a tus clientes reales".
#### Paso 4: Las Reglas de Enfrentamiento (RoE)
* En el documento RoE escribes expl√≠citamente:
	- **IPs permitidas:** Solo la IP del servidor de la App (192.168.1.50).
	- **IPs PROHIBIDAS:** El servidor de la base de datos principal (192.168.1.100).
	- **Contacto de Emergencia:** Si la App se cae, llamar a Juan P√©rez (SysAdmin) al 555-0199 inmediatamente.
	* ***Resultado:** Al tener esto firmado, si durante la prueba el servidor se cae por error, tienes un protocolo. Si no hubieras definido las IPs prohibidas y atacabas la base de datos, podr√≠as haber corrompido datos reales y enfrentado una demanda millonaria.

### üéì Resumen para llevar

- **Orden es Ley:** NDA -> Scoping -> SoW -> RoE -> Kick-off. No te saltes pasos.
    
- **SoW vs RoE:** El SoW es el negocio (Qu√©/Cu√°nto), el RoE es la operaci√≥n (C√≥mo/Cu√°ndo/D√≥nde).
    
- **Permiso de Terceros:** Si atacas algo en la nube, necesitas permiso del due√±o de la nube, no solo de tu cliente.
    
- **Protocolo de Emergencia:** Siempre ten claro a qui√©n llamar si rompes algo cr√≠tico.
    
- **F√≠sico = Riesgo Legal:** Nunca hagas pentesting f√≠sico sin el acuerdo de contratista espec√≠fico en tu bolsillo.
	
- **Legalidad ante todo:** Nunca empieces sin un contrato y un NDA firmados por alguien con autoridad (C-Level).
    
- **Claridad en el Alcance:** Define exactamente qu√© IPs, dominios y aplicaciones est√°n "dentro" y cu√°les "fuera" del juego.
    
- **El RoE es tu Biblia:** Las _Rules of Engagement_ dictan c√≥mo te comportas. S√≠guelas al pie de la letra.
    
- **Comunicaci√≥n:** Establece canales de emergencia. Si rompes algo cr√≠tico o encuentras un hueco enorme, avisa al instante.

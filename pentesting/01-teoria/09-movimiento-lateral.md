# 09 - Movimiento Lateral (Lateral Movement) ü¶Ä

> **üéØ Objetivo:** Aprender√°s c√≥mo un atacante no se conforma con entrar a un solo sistema, sino que busca expandirse por toda la red corporativa. Entender√°s la metodolog√≠a para "saltar" de una m√°quina a otra hasta dominar la organizaci√≥n completa.

---

#### 1. Introducci√≥n: ¬øQu√© pasa despu√©s de entrar?

Imagina que has logrado penetrar la fortaleza (la red corporativa), has recolectado informaci√≥n local y has escalado privilegios en esa primera m√°quina. ¬øSe acab√≥ el juego? **No**. Aqu√≠ es donde empieza lo divertido: el **Lateral Movement** (Movimiento Lateral).

El objetivo cambia dr√°sticamente. Ya no se trata solo de explotar un sistema p√∫blico, sino de probar qu√© tanto da√±o podr√≠a hacer un atacante dentro de la red completa. Buscamos:

1. Datos sensibles (bases de datos, secretos comerciales).
    
2. Formas de inutilizar toda la red.
    

> **üí° Analog√≠a:** Entrar a la red es como forzar la puerta principal de un edificio de oficinas. El **Movimiento Lateral** es caminar por los pasillos, abrir las puertas de las otras oficinas, revisar los archivadores del jefe y asegurarte de tener llaves maestras para todo el edificio.

El Escenario de Pesadilla: Ransomware ü¶†

El ejemplo m√°s com√∫n de por qu√© esto es vital es el Ransomware.

- Si una PC se infecta, el malware usa t√©cnicas de movimiento lateral para propagarse.
    
- Bloquea todos los sistemas con cifrado.
    
- La empresa queda paralizada hasta que pagan.
    

El Costo del Negocio üí∏

A menudo, las empresas solo valoran la ciberseguridad cuando ya est√°n siendo extorsionadas.

- **Responsabilidad:** En muchos pa√≠ses, los **CEOs son responsables legalmente** por no asegurar los datos de los clientes.
    
- Un buen pentester (t√∫) simula esto para evitar da√±os financieros y legales antes de que ocurran.
    

---

#### 2. El Ciclo del Movimiento Lateral

En esta etapa, queremos ver hasta d√≥nde podemos llegar manualmente. No es un camino lineal, sino un ciclo que se repite en cada nueva m√°quina que conquistamos:

1. **Pivoting** (Pivotaje/Tunelizaci√≥n).
    
2. **Evasive Testing** (Pruebas Evasivas).
    
3. **Information Gathering** (Recolecci√≥n de Informaci√≥n).
    
4. **Vulnerability Assessment** (Evaluaci√≥n de Vulnerabilidades).
    
5. **(Privilege) Exploitation** (Explotaci√≥n de Privilegios).
    
6. **Post-Exploitation** (Post-Explotaci√≥n).

![[ciclo-movimiento-lateral.png]]

---

#### 3. Pivoting: Tu Puente Invisible üåâ

A veces, no puedes escalar privilegios directamente en la m√°quina donde est√°s, pero puedes usarla para llegar a otras partes de la red que no son accesibles desde internet.

Aqu√≠ entra el **Pivoting**. Como nuestras herramientas de ataque est√°n "fuera" y la red interna est√° "dentro", usamos el host comprometido como un **Proxy**.

> **‚úâÔ∏è Analog√≠a del Cartero:** Imagina que quieres enviarle una carta a alguien que vive en una comunidad cerrada y exclusiva (Red Interna) donde el correo normal no entra. T√∫ (Atacante) le das la carta a un residente que ya conoces dentro (Host Comprometido), y √©l la entrega por ti. Para el destinatario, la carta vino del residente, no de ti.

¬øQu√© logramos con esto?

Enrutamos nuestras peticiones a trav√©s del host infectado. Esto nos permite escanear y atacar redes no enrutables (inaccesibles p√∫blicamente). A esto tambi√©n se le llama Tunneling.

![[tunneling.png]]

---

#### 4. Evasive Testing: El Arte del Sigilo ü•∑

Ya est√°s dentro, pero no quieres que te vean. Los administradores y el Blue Team (equipo de defensa) tienen alarmas.

Debemos considerar:

- **Network Segmentation** (Segmentaci√≥n de red).
    
- **Threat Monitoring** (Monitoreo de amenazas).
    
- **IDS/IPS** (Sistemas de Detecci√≥n/Prevenci√≥n de Intrusos).
    
- **EDR** (Endpoint Detection and Response).
    

> **üõ°Ô∏è Nota de Seguridad:** Para evadir estas defensas, primero debes entender c√≥mo funcionan. Si sabes qu√© dispara una alarma (ej: escanear 1000 puertos en 1 segundo), puedes adaptar tu estrategia (ej: escanear lentamente) para ser invisible.

---

#### 5. Reconocimiento y Evaluaci√≥n Interna üîç

Ahora hacemos **Information Gathering** y **Vulnerability Assessment**, pero desde una perspectiva interna.

Diferencia Clave:

| **Evaluaci√≥n Externa (Internet) üåê**       | **Evaluaci√≥n Interna (Lateral Movement) üè¢**                        |
| ------------------------------------------ | ------------------------------------------------------------------- |
| **Exposici√≥n**                             | Pocos sistemas expuestos (Webs, VPNs, Mail).                        |
| **Seguridad**                              | Configuraciones generalmente m√°s robustas (Hardened).               |
| **Confianza**                              | Menos confianza entre sistemas (Zero Trust ideal).                  |
Aqu√≠ buscamos **Grupos** y **Derechos (Rights)**.

- _Ejemplo:_ Si comprometes la cuenta de un usuario que pertenece al grupo "Desarrolladores", de repente tienes acceso a todo el c√≥digo fuente y servidores de desarrollo de la empresa.
    

---

#### 6. Explotaci√≥n y "Pass-the-Hash" üîë

Una vez identificados los objetivos internos, atacamos.

A menudo no necesitamos "hacks" complejos; usamos las credenciales que ya encontramos.

**T√©cnicas Comunes:**

1. **Cracking de contrase√±as:** Romper hashes encontrados.
    
2. **Reutilizaci√≥n de credenciales:** Probar la contrase√±a del Usuario A en la M√°quina B.
    
3. **Pass-the-Hash (PtH):** Esta es una t√©cnica reina en entornos Windows.
    

> üí° Concepto Clave: Pass-the-Hash
> 
> A veces no necesitas saber la contrase√±a en texto plano (ej: "Gato123"). Si tienes el Hash NTLMv2 (la versi√≥n cifrada de la contrase√±a), muchos sistemas te dejar√°n entrar solo present√°ndoles ese hash. Es como si el portero de la discoteca no te pidiera tu nombre, sino solo el sello en tu mano.

**Herramienta:** Responder o MITM6

Se usa para interceptar estos hashes en la red. Si capturas el hash de un administrador, puedes usar la t√©cnica PtH para loguearte en m√∫ltiples servidores.

---

#### 7. Ejemplo Pr√°ctico: ¬øC√≥mo se ve esto en la vida real? üõ†Ô∏è

Imagina que has comprometido una PC de Recepci√≥n (Host A). Quieres llegar al Servidor de Finanzas (Host B).

1. **El Pivote (SSH Tunneling / Chisel):**
    
    - Usas una herramienta como `Chisel` o `SSH` para crear un t√∫nel.
        
    - _Comando mental:_ "Todo el tr√°fico que env√≠e a mi puerto local 9090, env√≠alo a trav√©s de la PC de Recepci√≥n hacia la red interna".
        
    - Ahora, tu navegador o tus herramientas de escaneo (Nmap) pasan por ese t√∫nel.
        
2. **El Reconocimiento (BloodHound / SharpHound):**
    
    - Ejecutas un recolector de informaci√≥n (como SharpHound) en la PC de Recepci√≥n.
        
    - Este mapa te dice: "El usuario 'Admin_Finanzas' se logue√≥ recientemente en la PC de Recepci√≥n". ¬°Bingo! Su credencial (hash) podr√≠a estar en la memoria.
        
3. **El Robo (Mimikatz):**
    
    - Usas una herramienta como `Mimikatz` en la PC de Recepci√≥n para extraer los hashes de memoria.
        
    - Obtienes el NTLM Hash del administrador.
        
4. **El Ataque (Pass-the-Hash):**
    
    - Usas una herramienta como `Evil-WinRM` o `CrackMapExec` desde tu m√°quina atacante, pasando por el t√∫nel.
        
    - En lugar de poner contrase√±a, le das el Hash.
        
    - El Servidor de Finanzas te acepta. ¬°Est√°s dentro!
        
5. **Repetir:** Ahora est√°s en Finanzas. ¬øQu√© hay conectado a Finanzas? El ciclo comienza de nuevo.
    

---

### üéì Resumen para llevar

- **El objetivo es el dominio total:** No basta con entrar; hay que moverse para encontrar los "tesoros" o demostrar el impacto total (como un Ransomware).
    
- **Pivoting es esencial:** Es la t√©cnica que te permite usar una m√°quina hackeada como trampol√≠n para alcanzar redes profundas.
    
- **La red interna es "suave":** Por dentro, las redes suelen tener m√°s vulnerabilidades, permisos mal configurados y confianza excesiva entre usuarios.
    
- **Las credenciales son oro:** A menudo, moverse lateralmente no requiere exploits complejos, sino robar credenciales (o hashes) y reutilizarlas en otras m√°quinas.

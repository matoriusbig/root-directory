# 1 - IntroducciÃ³n a Nmap: El CartÃ³grafo de la Red ğŸŒ

> **ğŸ¯ Objetivo:** Entender quÃ© es **Nmap**, por quÃ© es la herramienta _de facto_ para cualquier profesional de seguridad, y comprender profundamente cÃ³mo interactÃºa con los puertos mediante su famoso escaneo TCP-SYN.

---

### 1. Â¿QuÃ© es Nmap realmente? ğŸ•µï¸â€â™‚ï¸

**Nmap (Network Mapper)** es una herramienta de cÃ³digo abierto (escrita en C, C++, Python y Lua) diseÃ±ada para el anÃ¡lisis de redes y auditorÃ­as de seguridad.

Si bien tu navegador web envÃ­a paquetes de datos "educados" y estÃ¡ndar, Nmap es diferente. Nmap construye y envÃ­a **paquetes crudos (raw packets)**. Esto significa que manipula los bits del paquete de red a bajo nivel para obtener respuestas que el sistema operativo normal no revelarÃ­a.

> ğŸ—£ï¸ Para que entiendas mejor:
> 
> "Imagina que entras en una habitaciÃ³n oscura (la red). Una persona normal caminarÃ­a tanteando las paredes. Nmap es como un murciÃ©lago o un chasqueador de The Last Of Us: envÃ­a ondas de sonido precisas (paquetes) y escucha cÃ³mo rebotan. Dependiendo del eco, sabe si hay una silla (host), de quÃ© material es (sistema operativo) y si tiene algo encima (servicios)."

**Â¿QuÃ© es capaz de identificar?**

- Hosts disponibles en la red.
    
- Servicios y aplicaciones (Nombres y Versiones).
    
- Sistemas Operativos (OS) y sus versiones.
    
- Filtros de paquetes, Firewalls e IDS (Sistemas de DetecciÃ³n de Intrusos).
    

---

### 2. Los Usos de la Navaja Suiza ğŸ› ï¸

Nmap es la herramienta mÃ¡s utilizada por administradores y especialistas en seguridad. No solo sirve para "hackear", sirve para **conocer**.

|**Caso de Uso**|**DescripciÃ³n**|
|---|---|
|**AuditorÃ­a de Seguridad**|Verificar quÃ© tan segura es una red corporativa.|
|**Pentesting**|Simular ataques para encontrar brechas antes que los malos.|
|**Chequeo de Defensas**|Validar si el Firewall o el IDS estÃ¡n configurados correctamente.|
|**Mapeo de Red**|Dibujar un mapa de quÃ© dispositivos estÃ¡n conectados y cÃ³mo.|
|**EvaluaciÃ³n de Vulnerabilidades**|Encontrar puertas abiertas (puertos) que podrÃ­an ser peligrosas.|

---

### 3. Arquitectura: Los 5 Pilares de un Escaneo ğŸ›ï¸

Nmap no "solo escanea". Sigue una metodologÃ­a lÃ³gica dividida en estas tÃ©cnicas:

1. **Host Discovery (Descubrimiento de Host):** Â¿QuiÃ©n estÃ¡ vivo en la red?
    
2. **Port Scanning (Escaneo de Puertos):** Â¿QuÃ© puertas tiene abiertas?
    
3. **Service Enumeration (DetecciÃ³n de Servicios):** Â¿QuÃ© programa estÃ¡ detrÃ¡s de esa puerta?
    
4. **OS Detection (DetecciÃ³n de SO):** Â¿Es Windows, Linux, Android?
    
5. **NSE (Nmap Scripting Engine):** InteracciÃ³n avanzada mediante scripts para tareas especÃ­ficas.
    

---

### 4. Sintaxis y TÃ©cnicas de Escaneo ğŸ’»

La sintaxis bÃ¡sica es engaÃ±osamente simple, pero poderosa:

```
nmap <tipo de escaneo> <opciones> <objetivo>
```

Nmap ofrece mÃºltiples formas de tocar la puerta (TÃ©cnicas de Escaneo). AquÃ­ tienes las mÃ¡s importantes que verÃ¡s escribiendo en la consola (`nmap --help`):

| **âš™ï¸ TÃ©cnica / Comando**                       | **ğŸ§  DefiniciÃ³n **                                                                                                                          | **ğŸ’¡ Uso Real                                                                                                                                                                             |
| ---------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **TCP SYN Scan**<br>`-sS`                      | **"Medio Abierto"**. EnvÃ­a `SYN`, recibe `SYN-ACK`, pero responde con `RST`. No completa la conexiÃ³n TCP. Es el _default_ si eres `root`.   | ğŸƒ **"El Ring Raje"**: Tocas el timbre y corres antes de que abran del todo.<br>âœ… **Uso:** El 90% de tus escaneos. RÃ¡pido y sigiloso.                                                     |
| **TCP Connect Scan**<br>`-sT`                  | **"ConexiÃ³n Completa"**. Realiza el _3-Way Handshake_ completo (`SYN` > `SYN-ACK` > `ACK`). El servidor registra tu IP en sus logs.         | ğŸ‘” **"El Vendedor Educado"**: Saludas, te presentas y entras. Dejas huella.<br>âœ… **Uso:** Cuando **NO** tienes permisos de administrador (`sudo`).                                        |
| **UDP Scan**<br>`-sU`                          | **"Sin ConexiÃ³n"**. EnvÃ­a paquetes a puertos UDP. Si recibe error ICMP = Cerrado. Si hay silencio = Open/Filtered.                          | ğŸ¾ **"Pelota al Muro:"** Tiras una pelota al patio vecino. Si no vuelve, no sabes si cayÃ³ en pasto o se la quedaron.<br>âœ… **Uso:** Vital para DNS (53), SNMP (161). ğŸ¢ **Muy lento**.     |
| **Null / FIN / Xmas**<br>`-sN` / `-sF` / `-sX` | **"ManipulaciÃ³n de Flags"**. EnvÃ­an paquetes anormales (Sin flags, solo FIN, o Todo encendido). Esperan un `RST` si el puerto estÃ¡ cerrado. | ğŸ‘» **"El Comportamiento ExtraÃ±o":** <br>Entras a una sala caminando raro. Si nadie te echa, asumes que puedes quedarte.<br>âœ… **Uso:** Evadir Firewalls en Linux/Unix. âŒ Falla en Windows. |
| **TCP ACK Scan**<br><br><br>`-sA`              | **"Mapeo de Firewall"**. EnvÃ­a solo `ACK`. No detecta puertos "Open", detecta si el puerto es "Filtered" (con firewall) o "Unfiltered".     | ğŸ‘® **"La Prueba del Guardia":** Intentas pasar diciendo "ya estaba adentro". Pruebas si el guardia te para.<br>âœ… **Uso:** Entender las reglas del Firewall, no para hackear servicios.    |
| **Idle / Zombie Scan**<br>`-sI <zombie>`       | **"Ataque de Rebote"**. Usa una mÃ¡quina inactiva (Zombie) para escanear. Nmap falsifica la IP del Zombie.                                   | ğŸ­ **"El Titiritero":** Usas un muÃ±eco para molestar al perro. Si el perro muerde, muerde al muÃ±eco<br>âœ… **Uso:** Anonimato extremo. Tu IP nunca toca al objetivo.                        |
| **IP Protocol Scan**<br>`-sO`                  | **"Escaneo de Protocolo"**. Itera sobre los protocolos IP (TCP, UDP, ICMP, IGMP, etc.) para ver cuÃ¡les soporta la mÃ¡quina.                  | ğŸ¨ **"Â¿QuÃ© edificio es?":** No preguntas por habitaciones, preguntas si es un Hotel o un Hospital.<br>âœ… **Uso:** Identificar tipos de dispositivos (Routers vs Servidores).               |
| **FTP Bounce Scan**<br>`-b <host>`             | **"Proxy FTP"**. Abusa de servidores FTP antiguos para enviar datos a otros puertos dentro de la red.                                       | ğŸ± **"Tiro de Billar":** Golpeas la bola blanca (FTP) para darle a la bola 8 (Objetivo).<br>âœ… **Uso:** HistÃ³rico/AcadÃ©mico. Casi extinto hoy en dÃ­a.                                      |

---

### 5. Profundizando: El Escaneo TCP-SYN (`-sS`) âš¡

Este es el escaneo por defecto si tienes permisos de administrador (root). Es rÃ¡pido (miles de puertos por segundo) y sigiloso.

Â¿CÃ³mo funciona la magia?

Para entender el -sS, primero recordemos cÃ³mo se saludan dos computadoras (TCP 3-Way Handshake):

1. **SYN** (Hola, quiero conectar).
    
2. **SYN-ACK** (Hola, te escucho, procedamos).
    
3. **ACK** (Perfecto, conexiÃ³n establecida).

![[3-way-handshake.png]]

El **TCP-SYN Scan** rompe esta regla. EnvÃ­a el **SYN**, recibe la respuesta, pero **NUNCA** envÃ­a el **ACK** final.

> ğŸ—£ï¸ Ejemplo:
> 
> "Imagina el juego de 'tocar el timbre y correr' (Ding Dong Ditch).
> 
> - Tocas el timbre (**SYN**).
>     
> - Si alguien abre y dice 'Â¿SÃ­?' (**SYN-ACK**), sabes que hay alguien en casa (**Open**).
>     
> - Pero tÃº no entras a tomar cafÃ©; tÃº anotas 'hay gente' y te vas corriendo antes de establecer una conversaciÃ³n formal. Eso hace que el escaneo sea mÃ¡s rÃ¡pido y a veces, menos detectable."


![[tcp-syn-scan.png]]
#### Interpretando las Respuestas del Objetivo:

|**Respuesta del Objetivo**|**Estado segÃºn Nmap**|**ExplicaciÃ³n**|
|---|---|---|
|**SYN-ACK** ğŸŸ¢|`open`|El puerto estÃ¡ abierto y escuchando. Nmap envÃ­a un RST (Reset) para cortar la conexiÃ³n inmediatamente.|
|**RST** ğŸ”´|`closed`|La computadora dice: "AquÃ­ no vive nadie". El puerto estÃ¡ cerrado pero accesible.|
|**Sin Respuesta** ğŸ”‡|`filtered`|El silencio total. Generalmente significa que un **Firewall** bloqueÃ³ o descartÃ³ tu paquete. Nmap no sabe si estÃ¡ abierto o cerrado.|

> **ğŸ›¡ï¸ Nota de Seguridad:** Debido a que el escaneo `-sS` manipula paquetes crudos y no completa la conexiÃ³n TCP, **requiere privilegios de root/sudo** para ejecutarse. Si no eres root, Nmap usarÃ¡ por defecto `-sT` (Connect Scan), que es mÃ¡s lento y ruidoso en los logs del servidor.

---

### 6. Analizando un Resultado Real ğŸ“Š

Veamos un ejemplo prÃ¡ctico de ejecuciÃ³n:

```
kali@kali[/home]$ sudo nmap -sS localhost
```

**Salida explicada:**

```
PORT     STATE SERVICE
22/tcp   open  ssh          <-- Puerta 22 abierta, servicio SSH escuchando.
80/tcp   open  http         <-- Puerta 80 abierta, servidor Web.
5432/tcp open  postgresql   <-- Base de datos.
5901/tcp open  vnc-1        <-- Escritorio remoto.
```

- **Latency:** Te dice quÃ© tan rÃ¡pido respondiÃ³ el host (0.000010s es instantÃ¡neo, probablemente local).
    
- **Not shown:** 996 puertos cerrados (Nmap escanea los 1000 puertos mÃ¡s comunes por defecto; si solo muestra 4, el resto no respondiÃ³ favorablemente).

![[tcp-syn-vs-3-way-handshake.png]]

---

### ğŸ“ Resumen para llevar

- **Nmap es el rey:** Sirve para auditar, mapear y encontrar vulnerabilidades usando paquetes crudos.
    
- **El escaneo `-sS` (SYN) es tu mejor amigo:** Es rÃ¡pido y no completa la conexiÃ³n TCP (Half-open), lo que lo hace ideal para barridos rÃ¡pidos.
    
- **Los 3 estados vitales:**
    
    - **Open:** Te respondieron (SYN-ACK).
        
    - **Closed:** Te rechazaron activamente (RST).
        
    - **Filtered:** Te ignoraron (Culpa del Firewall).
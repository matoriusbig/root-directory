# 01 - Descubrimiento de Hosts: El Arte de Mapear la Red üåê

> **üéØ Objetivo:** Aprender√°s a identificar qu√© sistemas est√°n activos (vivos) en una red antes de atacarlos. Es el paso fundamental de reconocimiento: no puedes hackear lo que no sabes que existe.

---

## 1. Introducci√≥n: Encendiendo la Luz en la Habitaci√≥n üí°

Imagina que eres un ladr√≥n (√©tico) y entras en un edificio de oficinas completamente a oscuras. Antes de intentar abrir cajas fuertes, primero necesitas saber **d√≥nde est√°n los guardias y d√≥nde est√°n las puertas**, ¬øverdad?

En ciberseguridad, esto es el **Host Discovery** (Descubrimiento de Hosts). Cuando realizamos una prueba de penetraci√≥n interna, nuestro primer trabajo es obtener una panor√°mica de qu√© sistemas est√°n "online" y disponibles para interactuar.

La herramienta reina para esto es **Nmap**. Aunque existen muchas formas de preguntar "¬øest√°s ah√≠?", el m√©todo m√°s com√∫n es el **ICMP Echo Request** (lo que com√∫nmente llamamos "Ping").

> **üí° Nota:** Siempre, y quiero decir SIEMPRE, guarda los resultados de tus escaneos. Es vital para la documentaci√≥n, comparaci√≥n y reportes.

---

## 2. Escaneando un Rango de Red üì°

A veces queremos barrer toda una red para ver qui√©n responde. Imagina que gritas "¬øHay alguien aqu√≠?" en un pasillo largo.

Para hacer esto con Nmap en un rango de red (por ejemplo, `10.129.2.0/24`), usamos comandos espec√≠ficos para ser eficientes y no hacer ruido innecesario.

**El Comando M√°gico:**

Bash

```
sudo nmap 10.129.2.0/24 -sn -oA tnet
```

Vamos a desglosar qu√© acabamos de escribir:

|**Opci√≥n**|**Descripci√≥n**|**Analog√≠a**|
|---|---|---|
|`10.129.2.0/24`|El rango de red objetivo.|La direcci√≥n de la calle completa.|
|`-sn`|**Deshabilita el escaneo de puertos.** Solo comprueba si el host est√° vivo.|Solo tocas el timbre, no intentas abrir las ventanas.|
|`-oA tnet`|Guarda los resultados en todos los formatos con el nombre 'tnet'.|Tomas una foto, escribes una nota y grabas un audio de qui√©n respondi√≥.|

> **üõ°Ô∏è Nota de Seguridad:** Este m√©todo `-sn` depende de que el **Firewall** (Cortafuegos) de los objetivos permita el Ping (ICMP). Si el firewall bloquea el ping, el host parecer√° "muerto" aunque est√© encendido. M√°s adelante veremos c√≥mo evadir esto.

---

## 3. Escaneando desde una Lista VIP üìù

En un entorno profesional, a menudo el cliente te dar√° una lista espec√≠fica de direcciones IP que debes auditar. No necesitas escanear toda la red, solo los objetivos permitidos.

Nmap nos permite leer esta lista directamente con la flag `-iL` (Input List).

**El Proceso:**

1. Tienes un archivo `hosts.lst` con las IPs una debajo de otra.
    
2. Ejecutas:
    
    Bash
    
    ```
    sudo nmap -sn -oA tnet -iL hosts.lst
    ```
    

Si en la lista hay 7 IPs y solo responden 3, Nmap marcar√° las otras 4 como inactivas. Pero recuerda: **Inactivo no siempre significa apagado**, puede significar que est√°n ignorando tus peticiones (filtrado).

---

## 4. Escaneando IPs M√∫ltiples o Rangos Peque√±os üéØ

Nmap es muy flexible. Si solo quieres escanear un peque√±o grupo de amigos, no necesitas crear una lista ni escanear toda la subred.

- **IPs separadas:** `10.129.2.18 10.129.2.19`
    
- **Rangos en el √∫ltimo octeto:** `10.129.2.18-20` (Esto escanear√° la .18, .19 y .20).
    

---

## 5. Disecci√≥n T√©cnica: ¬øQu√© ocurre bajo el cap√≥? üîß

Aqu√≠ es donde la cosa se pone t√©cnica y fascinante. Presta atenci√≥n.

Cuando escaneamos un host individual para ver si est√° vivo, generalmente esperamos que Nmap env√≠e un **ICMP Echo Request** (Ping). Pero Nmap es "inteligente".

Si est√°s en la misma red local (LAN) que tu objetivo, Nmap **NO** usa ICMP por defecto. Usa **ARP** (Address Resolution Protocol).

> **üñºÔ∏è Referencia Visual:**
> 
> - **Descripci√≥n:** Un diagrama dividido en dos. Arriba "Red Local": Muestra al atacante enviando un "ARP Request (¬øQui√©n tiene esta IP?)" y recibiendo un "ARP Reply". Abajo "Red Remota": Muestra al atacante enviando un "ICMP Echo Request" y recibiendo un "ICMP Echo Reply".
>     

### ¬øPor qu√© esto es importante?

Si ejecutas un escaneo simple con `sudo nmap 10.129.2.18 -sn`, Nmap har√° un **ARP Ping**.

- **Env√≠a:** ARP Request (_¬øQui√©n tiene la IP 10.129.2.18? dime tu MAC_).
    
- **Recibe:** ARP Reply (_Yo la tengo, mi MAC es DE:AD:BE:EF..._).
    

Podemos ver esto en acci√≥n usando la opci√≥n `--packet-trace`, que nos muestra cada paquete que sale y entra:

Bash

```
sudo nmap 10.129.2.18 -sn -oA host -PE --packet-trace
```

_Salida esperada:_ Ver√°s `SENT ARP who-has...` y `RCVD ARP reply...`.

### Forzando el ICMP (El verdadero Ping)

Si queremos probar si el firewall bloquea ICMP (y no solo confiar en ARP), debemos **obligar** a Nmap a no usar ARP.

Usamos la flag `--disable-arp-ping`.

**Comando Avanzado de Diagn√≥stico:**

Bash

```
sudo nmap 10.129.2.18 -sn -oA host -PE --packet-trace --disable-arp-ping
```

Ahora, la salida cambia radicalmente:

1. **SENT:** ICMP Echo request (type=8).
    
2. **RCVD:** ICMP Echo reply (type=0).
    

|**Opci√≥n**|**Funci√≥n**|
|---|---|
|`-PE`|Forza el uso de **ICMP Echo requests** (el ping cl√°sico).|
|`--packet-trace`|Muestra los paquetes "desnudos" (traza de red) para depurar.|
|`--reason`|Te dice expl√≠citamente **por qu√©** Nmap cree que el host est√° vivo (ej: `received arp-response` o `received echo-reply`).|
|`--disable-arp-ping`|Obliga a usar la capa IP (L3) en lugar de la capa de enlace (L2), incluso en redes locales.|

---
## Chuelta de Nmap üëÅÔ∏è

![[Network_Enumeration_With_Nmap_Module_Cheat_Sheet.pdf]]
### üéì Resumen para llevar

- **El primer paso es el mapa:** Antes de atacar, usa `-sn` (Ping Scan) para encontrar objetivos vivos sin tocar sus puertos.
    
- **Organizaci√≥n:** Usa `-oA` para guardar todo y `-iL` si tienes una lista de objetivos definida.
    
- **ARP vs ICMP:** En redes locales, Nmap prefiere **ARP** porque es m√°s r√°pido y fiable. Si quieres probar reglas de firewall o simular un ataque externo, debes deshabilitar ARP con `--disable-arp-ping`.
    
- **Ojos abiertos:** Usa `--packet-trace` y `--reason` cuando no entiendas por qu√© un host responde (o no responde). Te mostrar√° la verdad de la red.